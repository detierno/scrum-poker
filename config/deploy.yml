# Kamal deployment for Planning Poker on AWS
# No domain required: use your EC2 public IP. See docs/deployment.md.

service: poker

image: denistierno/scrum-poker

# Replace 1.2.3.4 with your EC2 public IP. Access the app at http://1.2.3.4
servers:
  web:
    hosts:
      - 108.130.105.197
    # No domain: disable Traefik proxy and expose the app on port 80 directly.
    proxy: false
    options:
      publish:
        - "80:80"

ssh:
  user: ubuntu
  # Path to your EC2 key pair .pem (required for AWS). Use a path that works from your machine.
  keys:
    - ~/.ssh/scrum-key.pem

# No proxy when using IP-only (proxy: false above). Omit or leave empty.
# proxy:
#   ssl: true
#   host: poker.yourdomain.com

registry:
  username: denistierno
  password:
    - KAMAL_REGISTRY_PASSWORD

env:
  secret:
    - RAILS_MASTER_KEY
  clear:
    REDIS_URL: redis://poker-redis:6379/1
    # Use your EC2 public IP so share links work (e.g. http://3.14.159.26/rooms/join?code=ABC123)
    RAILS_HOST: 108.130.105.197

aliases:
  console: app exec --interactive --reuse "bin/rails console"
  shell: app exec --interactive --reuse "bash"
  logs: app logs -f

asset_path: /rails/public/assets

builder:
  arch: amd64

accessories:
  redis:
    image: redis:7-alpine
    roles:
      - web
    port: "127.0.0.1:6379:6379"
    directories:
      - redis_data:/data
